<!-- Cabeçalho do Filme -->
<div class="row mb-4">
  <div class="col">
    <%= link_to "← Voltar", movies_path, class: "btn btn-outline-secondary btn-sm mb-3" %>
    
    <h1><%= @movie.title %></h1>
    
    <div class="mb-3">
      <span class="badge bg-primary"><%= @movie.release_year %></span>
      <span class="badge bg-secondary"><%= @movie.duration %> min</span>
    </div>
    
    <p class="text-muted">
      <strong>Diretor:</strong> <%= @movie.director %><br>
      <strong>Adicionado por:</strong> <%= @movie.user.email %><br>
      <strong>Data:</strong> <%= l(@movie.created_at, format: :long) %>
    </p>
    
    <!-- Botões de Ação (apenas para dono) -->
    <% if user_signed_in? && @movie.user == current_user %>
      <div class="btn-group">
        <%= link_to "✏️ Editar", edit_movie_path(@movie), class: "btn btn-warning btn-sm" %>
        <%= button_to "🗑️ Excluir", movie_path(@movie), method: :delete, 
            data: { turbo_confirm: "Tem certeza que deseja excluir este filme?" }, 
            class: "btn btn-danger btn-sm" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Sinopse -->
<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">📖 Sinopse</h5>
    <p class="card-text"><%= simple_format(@movie.synopsis) %></p>
  </div>
</div>

<!-- Seção de Comentários -->
<div class="card">
  <div class="card-header">
    <h5 class="mb-0">💬 Comentários (<%= @comments.count %>)</h5>
  </div>
  <div class="card-body">
    
    <!-- Formulário de Novo Comentário -->
    <div class="mb-4 p-3 bg-light rounded">
      <h6>Adicionar Comentário</h6>
      <%= form_with(model: [@movie, @comment], local: true) do |f| %>
        
        <% unless user_signed_in? %>
          <div class="mb-3">
            <%= f.label :name, "Seu nome:", class: "form-label" %>
            <%= f.text_field :name, class: "form-control", placeholder: "Digite seu nome" %>
          </div>
        <% end %>
        
        <div class="mb-3">
          <%= f.label :content, "Comentário:", class: "form-label" %>
          <%= f.text_area :content, rows: 3, class: "form-control", 
              placeholder: "O que você achou deste filme?" %>
        </div>
        
        <%= f.submit "Enviar Comentário", class: "btn btn-primary" %>
      <% end %>
    </div>

    <!-- Lista de Comentários -->
    <% if @comments.any? %>
      <% @comments.each do |comment| %>
        <div class="border-bottom pb-3 mb-3">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <strong><%= comment.commenter_name %></strong>
              <% if comment.user %>
                <span class="badge bg-success">Usuário</span>
              <% end %>
              <small class="text-muted d-block">
                <%= time_ago_in_words(comment.created_at) %> atrás
              </small>
            </div>
          </div>
          <p class="mt-2 mb-0"><%= simple_format(comment.content) %></p>
        </div>
      <% end %>
    <% else %>
      <p class="text-muted text-center">Seja o primeiro a comentar!</p>
    <% end %>
    
  </div>
</div>